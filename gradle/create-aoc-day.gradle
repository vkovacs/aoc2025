def aocPackage = project.hasProperty("aocPackage") ? project.property("aocPackage") : project.ext.has("aocPackage") ? project.ext.aocPackage : "default.package"


tasks.register("createAocDayTask") {
    group = "aoc"
    description = "Creates boilerplate source + resource files for AoC"

    doLast {
        if (!project.hasProperty("day")) {
            throw new GradleException("Usage: ./gradlew createAocDay -Pday=1")
        }

        def day = project.property("day").toString().padLeft(2, '0')
        def pkgPath = aocPackage.replace('.', '/')

        def mainJavaDir = layout.projectDirectory.dir("src/main/java/${pkgPath}/day${day}").asFile
        def testJavaDir = layout.projectDirectory.dir("src/test/java/${pkgPath}/day${day}").asFile
        def mainResDir = layout.projectDirectory.dir("src/main/resources/day${day}").asFile
        def testResDir = layout.projectDirectory.dir("src/test/resources/day${day}").asFile

        mainJavaDir.mkdirs()
        testJavaDir.mkdirs()
        mainResDir.mkdirs()
        testResDir.mkdirs()

        // -------- Solution file --------
        def logicFile = new File(mainJavaDir, "Day${day}Solution.java")
        if (!logicFile.exists()) {
            logicFile.text = """
package ${aocPackage}.day${day};

import java.util.List;

public class Day${day}Solution {

    public String part1(List<String> lines) {
        return "";
    }

    public String part2(List<String> lines) {
        return "";
    }
}
""".trim()
        }

        // -------- Test file --------
        def testFile = new File(testJavaDir, "Day${day}SolutionTest.java")
        if (!testFile.exists()) {
            testFile.text = """
package ${aocPackage}.day${day};

import lombok.SneakyThrows;
import org.junit.jupiter.api.Test;

import java.nio.file.Files;
import java.nio.file.Path;
import java.util.List;
import java.util.Objects;

import static org.junit.jupiter.api.Assertions.assertEquals;

class Day${day}SolutionTest {

    @Test
    void testPart1() {
        var solution = new Day${day}Solution();
        var lines = readLines("/day${day}/input-test.txt");
        assertEquals("", solution.part1(lines));
    }

    @Test
    void testPart2() {
        var solution = new Day${day}Solution();
        var lines = readLines("/day${day}/input-test.txt");
        assertEquals("", solution.part2(lines));
    }

    @Test
    void testPart1_withRealInput() {
        var solution = new Day${day}Solution();
        var lines = readLines("/day${day}/input.txt");
        assertEquals("", solution.part1(lines));  // fill when solution known
    }

    @Test
    void testPart2_withRealInput() {
        var solution = new Day${day}Solution();
        var lines = readLines("/day${day}/input.txt");
        assertEquals("", solution.part2(lines));  // fill when solution known
    }
    
    @SneakyThrows
    private List<String> readLines(String resourceName) {
        var uri = Objects.requireNonNull(getClass().getResource(resourceName)).toURI();
        return Files.readAllLines(Path.of(uri));
    }
}
""".trim()
        }

        // -------- Resource files --------
        new File(mainResDir, "input.txt").createNewFile()
        new File(testResDir, "input-test.txt").createNewFile()

        println "AoC day ${day} scaffolding generated."
    }
}